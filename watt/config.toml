# Watt Default Configuration

# Rules are evaluated by priority (higher number => higher priority).
# Each rule can specify conditions and actions for CPU and power management.

# Emergency thermal protection (highest priority).
[[rule]]
if       = { is-more-than = 85.0, value = "$cpu-temperature" }
priority = 100

cpu.energy-performance-preference = "power"
cpu.frequency-mhz-maximum         = 2000
cpu.governor                      = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo                         = { if = "?turbo-available", then = false }

# Critical battery preservation.
[[rule]]
if.all   = [ "?discharging", { is-less-than = 0.3, value = "%power-supply-charge" } ]
priority = 90

cpu.energy-performance-preference = "power"
cpu.frequency-mhz-maximum         = 800                                                            # More aggressive below critical threshold.
cpu.governor                      = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo                         = { if = "?turbo-available", then = false }
power.platform-profile            = "low-power"

# High performance mode for sustained high load.
[[rule]]
if.all = [
  { is-more-than = 0.8, value = "%cpu-usage" },
  { is-less-than = 30.0, value = "$cpu-idle-seconds" },
  { is-less-than = 75.0, value = "$cpu-temperature" },
]
priority = 80

cpu.energy-performance-preference = "performance"
cpu.governor                      = { if.is-governor-available = "performance", then = "performance" }
cpu.turbo                         = { if = "?turbo-available", then = true }

# Performance mode when not discharging.
[[rule]]
if.all = [
  { not = "?discharging" },
  { is-more-than = 0.1, value = "%cpu-usage" },
  { is-less-than = 80.0, value = "$cpu-temperature" },
]
priority = 70

cpu.energy-performance-bias       = "balance_performance"
cpu.energy-performance-preference = "performance"
cpu.governor                      = { if.is-governor-available = "performance", then = "performance" }
cpu.turbo                         = { if = "?turbo-available", then = true }

# Moderate performance for medium load.
[[rule]]
if.all = [
  { is-more-than = 0.4, value = "%cpu-usage" },
  { is-less-than = 0.8, value = "%cpu-usage" },
]
priority = 60

cpu.energy-performance-preference = "balance_performance"
cpu.governor                      = { if.is-governor-available = "schedutil", then = "schedutil" }

# Power saving during low activity.
[[rule]]
if.all = [
  { is-less-than = 0.2, value = "%cpu-usage" },
  { is-more-than = 60.0, value = "$cpu-idle-seconds" },
]
priority = 50

cpu.energy-performance-preference = "power"
cpu.governor                      = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo                         = { if = "?turbo-available", then = false }

# Extended idle power optimization.
[[rule]]
if       = { is-more-than = 300.0, value = "$cpu-idle-seconds" }
priority = 40

cpu.energy-performance-preference = "power"
cpu.frequency-mhz-maximum         = 1600
cpu.governor                      = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo                         = { if = "?turbo-available", then = false }

# Battery conservation when discharging.
[[rule]]
if.all   = [ "?discharging", { is-less-than = 0.5, value = "%power-supply-charge" } ]
priority = 30

cpu.energy-performance-preference = "power"
cpu.frequency-mhz-maximum         = 2000
cpu.governor                      = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo                         = { if = "?turbo-available", then = false }
power.platform-profile            = "low-power"

# General battery mode.
[[rule]]
if       = "?discharging"
priority = 20

cpu.energy-performance-bias       = "balance_power"
cpu.energy-performance-preference = "power"
cpu.frequency-mhz-maximum         = 1800
cpu.frequency-mhz-minimum         = 200
cpu.governor                      = { if.is-governor-available = "powersave", then = "powersave" }
cpu.turbo                         = { if = "?turbo-available", then = false }

# Balanced performance for general use. Default fallback rule.
[[rule]]
cpu.energy-performance-preference = "balance_performance"
cpu.governor                      = { if.is-governor-available = "schedutil", then = "schedutil" }
priority                          = 0
